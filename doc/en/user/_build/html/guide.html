<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Programmer’s Guide for Version 1.2 &mdash; Sun&#39;s XACML Implementation v2.0.0 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '2.0.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Sun&#39;s XACML Implementation v2.0.0 documentation" href="index.html" />
    <link rel="next" title="License" href="license.html" />
    <link rel="prev" title="Frequently Asked Questions" href="faq.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="license.html" title="License"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="faq.html" title="Frequently Asked Questions"
             accesskey="P">previous</a> |</li>
<li><a href="index.html">home</a>&nbsp;|&nbsp;</li>
<li><a href="http://sourceforge.net/projects/sunxacml">project page</a>&nbsp;|&nbsp;</li>
<li><a href="http://sourceforge.net/projects/sunxacml/files/">download</a>&nbsp;|&nbsp;</li>
<li><a href="http://sunxacml.hg.sourceforge.net/hgweb/sunxacml/sunxacml/">source code</a></li>
&raquo;
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="programmer-s-guide-for-version-1-2">
<h1>Programmer&#8217;s Guide for Version 1.2<a class="headerlink" href="#programmer-s-guide-for-version-1-2" title="Permalink to this headline">¶</a></h1>
<p>Last Updated: July 11, 2004</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Welcome to the programmer&#8217;s guide for Sun&#8217;s XACML Implementation. This
guide will introduce you to the APIs, the XACML (eXtensible Access
Control Markup Language) standard, and how to build support for XACML
into your applications. For more information about XACML, you should
visit the OASIS XACML technical committee&#8217;s <a class="reference external" href="http://www.oasis-open.org/committees/xacml/">web site</a>. For a complete listing of the
APIs, go check out the <a class="reference external" href="javadoc/index.html">JavaDocs</a>.</p>
<p>In a nutshell, XACML is a general-purpose access control policy
language. This means that it provides a syntax (defined in XML) for
managing authorization decisions. Sun&#8217;s XACML Implementation is a set
of Java TM classes that understand the XACML language, as well as the
rules about how to process requests and how to manage attributes and
other related data. With a relatively small amount of code, you can
write applications that use XACML to manage their own policy or that
hook into existing infrastructure components like LDAP or SAML. This
implementation requires a 1.4.0 or later JDK to build or run.</p>
</div>
<div class="section" id="a-brief-introduction-to-xacml">
<h2>A Brief Introduction to XACML<a class="headerlink" href="#a-brief-introduction-to-xacml" title="Permalink to this headline">¶</a></h2>
<p>XACML is an <a class="reference external" href="http://www.oasis-open.org">OASIS</a> standard that
describes both a policy language and an access control decision
request/response language (both encoded in XML). The policy language
is used to describe general access control requirements, and has
standard extension points for defining new functions, data types,
combining logic, etc. The request/response language lets you form a
query to ask whether or not a given action should be allowed, and
interpret the result. The response always includes an answer about
whether the request should be allowed using one of four values:
Permit, Deny, Indeterminate (an error occurred or some required value
was missing, so a decision cannot be made) or Not Applicable (the
request can&#8217;t be answered by this service).</p>
<p>The typical setup is that someone wants to take some action on a
resource. They will make a request to whatever actually protects that
resource (like a filesystem or a web server), which is called a Policy
Enforcement Point (PEP). The PEP will form a request based on the
requester&#8217;s attributes, the resource in question, the action, and
other information pertaining to the request. The PEP will then send
this request to a Policy Decision Point (PDP), which will look at the
request, find some policy that applies to the request, and come up
with an answer about whether access should be granted. That answer is
returned to the PEP, which can then allow or deny access to the
requester. Note that the PEP and PDP might both be contained within a
single application, or might be distributed across several servers. In
addition to providing request/response and policy languages, XACML
also provides the other pieces of this relationship, namely finding a
policy that applies to a given request and evaluating the request
against that policy to come up with a yes or no answer.</p>
<p>There are many existing proprietary and application-specific languages
for doing this kind of thing but XACML has several points in its
favor:</p>
<ul class="simple">
<li>It&#8217;s standard. By using a standard language, you&#8217;re using something
that has been reviewed by a large community of experts and users, you
don&#8217;t need to roll your own system each time, and you don&#8217;t need to
think about all the tricky issues involved in designing a new
language. Plus, as XACML becomes more widely deployed, it will be
easier to interoperate with other applications using the same standard
language.</li>
<li>It&#8217;s generic. This means that rather than trying to provide access
control for a particular environment or a specific kind of resource,
it can be used in any environment. One policy can be written which can
then be used by many different kinds of applications, and when one
common language is used, policy management becomes much easier.</li>
<li>It&#8217;s distributed. This means that a policy can be written which in
turn refers to other policies kept in arbitrary locations. The result
is that rather than having to manage a single monolithic policy,
different people or groups can manage separate sub-policies as
appropriate, and XACML knows how to correctly combine the results from
these different policies into one decision.</li>
<li>It&#8217;s powerful. While there are many ways the base language can be
extended, many environments will not need to do so. The standard
language already supports a wide variety of data types, functions, and
rules about combining the results of different policies. In addition
to this, there are already standards groups working on extensions and
profiles that will hook XACML into other standards like SAML and LDAP,
which will increase the number of ways that XACML can be used.</li>
</ul>
<p>To give you a better idea of how all these aspects fit together, what
follows is a brief discussion of XACML, which will demonstrate many of
its standard features. Note that XACML is a rich language, so only
some of its features are shown here. You should look at the
<a class="reference external" href="http://www.oasis-open.org/committees/xacml/repository/cs-xacml-specification-1.1.pdf">specification</a> for more information on all of the
features.</p>
<div class="section" id="top-level-constructs-policy-and-policyset">
<h3>Top-Level Constructs: Policy and PolicySet<a class="headerlink" href="#top-level-constructs-policy-and-policyset" title="Permalink to this headline">¶</a></h3>
<p>At the root of all XACML policies is a Policy or a PolicySet. A
PolicySet is a container that can hold other Policies or PolicySets,
as well as references to policies found in remote locations. A Policy
represents a single access control policy, expressed through a set of
Rules. Each XACML policy document contains exactly one Policy or
PolicySet root XML tag.</p>
<p>Because a Policy or PolicySet may contain multiple policies or Rules,
each of which may evaluate to different access control decisions,
XACML needs some way of reconciling the decisions each makes. This is
done through a collection of Combining Algorithms. Each algorithm
represents a different way of combining multiple decisions into a
single decision. There are Policy Combining Algorithms (used by
PolicySet) and Rule Combining Algorithms (used by Policy). An example
of these is the Deny Overrides Algorithm, which says that no matter
what, if any evaluation returns Deny, or no evaluation permits, then
the final result is also Deny. These Combining Algorithms are used to
build up increasingly complex policies, and they are what allow XACML
policies to be distributed and decentralized. While there are several
standard algorithms, you can build your own to suit your needs.</p>
</div>
<div class="section" id="targets-and-rules">
<h3>Targets and Rules<a class="headerlink" href="#targets-and-rules" title="Permalink to this headline">¶</a></h3>
<p>Part of what an XACML PDP does is find policies that apply to a given
request. To do this, XACML provides another feature called a Target. A
Target is basically a set of simplified conditions for the Subject,
Resource and Action that must be met for a PolicySet, Policy or Rule
to apply to a given request. These use boolean functions (explained
more in the next section) to compare values found in a request with
those included in the Target. If all the conditions of a Target are
met, then its associated PolicySet, Policy, or Rule applies to the
request. In addition to being a way to check applicability, Target
information also provides a way to index policies, which is useful if
you need to store many policies and then quickly sift through them to
find which ones apply. For instance, a Policy might contain a Target
that only applies to requests on a specific service. When a request to
access that service arrives, the PDP will know where to look for
policies that might apply to this request because the policies are
indexed based on their Target constraints. Note that a Target may also
specify that it applies to any request.</p>
<p>Once a Policy is found, and verified as applicable to a request, its
Rules are evaluated. A policy can have any number of Rules which
contain the core logic of an XACML policy. The heart of most Rules is
a Condition, which is a boolean function. If the Condition evaluates
to true, then the Rule&#8217;s Effect (Permit or Deny) is returned. If the
Condition evaluates to false, the the Condition doesn&#8217;t apply
(NotApplicable). Evaluation of a Condition can also result in an error
(Indeterminate). Conditions can be quite complex, built from an
arbitrary nesting of functions and attributes branching from the top-
level boolean function.</p>
</div>
<div class="section" id="attributes-attribute-values-and-functions">
<h3>Attributes, Attribute Values, and Functions<a class="headerlink" href="#attributes-attribute-values-and-functions" title="Permalink to this headline">¶</a></h3>
<p>The currency that XACML deals in is attributes. Attributes are named
values of known types that may include an issuer identifier or an
issue date and time. Specifically, attributes are characteristics of
the Subject, Resource, Action, or Environment in which the access
request is made. For example, A user&#8217;s name, their group membership, a
file they want to access, and the time of day are all attribute
values. When a request is sent from a PEP to a PDP, that request is
formed almost exclusively of attributes, and they will be compared to
attribute values in a policy to make the access decisions.</p>
<p>A Policy resolves attribute values from a request or from some other
source through two mechanisms: the AttributeDesignator and the
AttributeSelector. An AttributeDesignator lets the policy specify an
attribute with a given name and type, and optionally an issuer as
well. The PDP looks for that value in the request, and failing that,
can look in any other location (like a an LDAP service). There are
four kinds of designators, one for each of the types of attributes in
a request: Subject, Resource, Action, and Environment. Subject
attributes can be broken into different categories to support the
notion of multiple subjects making a request (eg, the user, the user&#8217;s
workstation, the user&#8217;s network, etc.), so SubjectAttributeDesignators
can also specify a category to look in. AttributeSelectors allow a
policy to look for attribute values through an XPath query. A data
type and an XPath expression are provided, and these can be used to
resolve some set of values either in the request document or elsewhere
(just as Designators do).</p>
<p>Both the AttributeDesignator and the AttributeSelector can return
multiple values (since there might be multiple matches in a request or
elsewhere), so XACML provides a special attribute type called a Bag.
Bags are unordered collections that allow duplicates, and are always
what designators and selectors return, even if only one value was
matched. In the case that no matches were made, an empty bag is
returned, although a designator or selector may set a flag that causes
an error instead in this case. Bags are never encoded in XML or
included in a policy or Request/Response.</p>
<p>Once some Bag of attribute values is retrieved, the values need to be
compared to the expected values to make access decisions. This is done
though a powerful system of functions. Functions can work on any
combination of attribute values, and can return any kind of attribute
value supported in the system. Functions can also be nested, so you
can have functions that operate on the output of other functions, and
this hierarchy can be arbitrarily complex. Custom functions can be
written to provide an ever richer language for expressing access
conditions.</p>
<p>One thing to note when building these hierarchies of functions is that
most of the standard functions are defined to work on specific types
(like strings or integers) while designators and selectors always
return Bags of values. To handle this mis-match, XACML defines a
collection of standard functions of the form [type]-one-and-only,
which accept a bag of values of the specified type and return the
single value if there is exactly one item in the bag, or an error if
there are zero or multiple values in the bag. These are among the most
common functions used in a Condition. Functions of the form [type
]-one-and-only functions are not needed in Targets, however, since the
PDP automatically applies the matching function to each element of a
bag.</p>
</div>
<div class="section" id="requests-and-responses">
<h3>Requests and Responses<a class="headerlink" href="#requests-and-responses" title="Permalink to this headline">¶</a></h3>
<p>In addition to defining a standard format for policy, XACML defines a
standard way of expressing Requests and Responses. A Request contains
Attributes in each of the four categories: Subject, Resource, Action,
and Environment (which is optional). There is exactly one collection
of Resource and Action Attributes in a Request, and at most one
collection of Environment Attributes. There may be multiple
collections of Subject Attributes, and each collection is identified
by a category URI (or, if no category is specified, then the default
category is used). In addition to Attributes, the Resource section
allows the inclusion of the content of the requested resource, which
can be considered in policy evaluation through XPath expressions. The
only Attribute that is required in a Request is the Resource
identifier.</p>
<p>A Response consists of one or more Results, each of which represents
the result of an evaluation. Multiple Results can only be caused by
evaluation of a hierarchical resource (explained later), so typically
there will only be one Result in a Response. Each Result contains a
Decision (Permit, Deny, NotApplicable, or Indeterminate), some Status
information (for instance, why evaluation failed), and optionally one
or more Obligations (things that the PEP is obligated to do before
granting or denying access). The Request and the Response provide a
standard format for interacting with a PDP.</p>
</div>
<div class="section" id="putting-it-together-an-example">
<h3>Putting it Together: An Example<a class="headerlink" href="#putting-it-together-an-example" title="Permalink to this headline">¶</a></h3>
<p>This is a very simple example that shows most of the features
discussed to this point. It is intended to be a concrete, valid
example of XACML, though not an illustration of all the powerful
features from the specification. Provided (in order) is a Request, a
Policy, and the expected Response from evaluating the Request against
the Policy. For sample code to let you do this evaluation, or for more
complete examples, look in the samples package.</p>
<p>The scenario shows a user trying to access a web page. The request
includes the Subject&#8217;s identity as well as a group they belong to, the
resource being accessed, and the action being taken. The policy
applies to anyone taking any action on the resource, and contains a
rule that applies to a specific action. The Condition in the Rule
requires certain group membership to access the resource.</p>
<p>The Request:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;Request&gt;</span>
  <span class="nt">&lt;Subject&gt;</span>
    <span class="nt">&lt;Attribute</span> <span class="na">AttributeId=</span><span class="s">&quot;urn:oasis:names:tc:xacml:1.0:subject:subject-id&quot;</span>
               <span class="na">DataType=</span><span class="s">&quot;urn:oasis:names:tc:xacml:1.0:data-type:rfc822Name&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;AttributeValue&gt;</span>seth@users.example.com<span class="nt">&lt;/AttributeValue&gt;</span>
    <span class="nt">&lt;/Attribute&gt;</span>
    <span class="nt">&lt;Attribute</span> <span class="na">AttributeId=</span><span class="s">&quot;group&quot;</span>
               <span class="na">DataType=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema#string&quot;</span>
               <span class="na">Issuer=</span><span class="s">&quot;admin@users.example.com&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;AttributeValue&gt;</span>developers<span class="nt">&lt;/AttributeValue&gt;</span>
    <span class="nt">&lt;/Attribute&gt;</span>
  <span class="nt">&lt;/Subject&gt;</span>
  <span class="nt">&lt;Resource&gt;</span>
    <span class="nt">&lt;Attribute</span> <span class="na">AttributeId=</span><span class="s">&quot;urn:oasis:names:tc:xacml:1.0:resource:resource-id&quot;</span>
               <span class="na">DataType=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema#anyURI&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;AttributeValue&gt;</span>http://server.example.com/code/docs/developer-guide.html<span class="nt">&lt;/AttributeValue&gt;</span>
    <span class="nt">&lt;/Attribute&gt;</span>
  <span class="nt">&lt;/Resource&gt;</span>
  <span class="nt">&lt;Action&gt;</span>
    <span class="nt">&lt;Attribute</span> <span class="na">AttributeId=</span><span class="s">&quot;urn:oasis:names:tc:xacml:1.0:action:action-id&quot;</span>
               <span class="na">DataType=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema#string&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;AttributeValue&gt;</span>read<span class="nt">&lt;/AttributeValue&gt;</span>
    <span class="nt">&lt;/Attribute&gt;</span>
  <span class="nt">&lt;/Action&gt;</span>
<span class="nt">&lt;/Request&gt;</span>
</pre></div>
</div>
<p>The Policy:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;Policy</span> <span class="na">PolicyId=</span><span class="s">&quot;ExamplePolicy&quot;</span>
        <span class="na">RuleCombiningAlgId=</span><span class="s">&quot;urn:oasis:names:tc:xacml:1.0:rule-combining-algorithm:permit-overrides&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Target&gt;</span>
    <span class="nt">&lt;Subjects&gt;</span>
      <span class="nt">&lt;AnySubject/&gt;</span>
    <span class="nt">&lt;/Subjects&gt;</span>
    <span class="nt">&lt;Resources&gt;</span>
      <span class="nt">&lt;Resource&gt;</span>
        <span class="nt">&lt;ResourceMatch</span> <span class="na">MatchId=</span><span class="s">&quot;urn:oasis:names:tc:xacml:1.0:function:anyURI-equal&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;AttributeValue</span> <span class="na">DataType=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema#anyURI&quot;</span><span class="nt">&gt;</span>http://server.example.com/code/docs/developer-guide.html<span class="nt">&lt;/AttributeValue&gt;</span>
          <span class="nt">&lt;ResourceAttributeDesignator</span> <span class="na">DataType=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema#anyURI&quot;</span>
                                       <span class="na">AttributeId=</span><span class="s">&quot;urn:oasis:names:tc:xacml:1.0:resource:resource-id&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/ResourceMatch&gt;</span>
      <span class="nt">&lt;/Resource&gt;</span>
    <span class="nt">&lt;/Resources&gt;</span>
    <span class="nt">&lt;Actions&gt;</span>
      <span class="nt">&lt;AnyAction/&gt;</span>
    <span class="nt">&lt;/Actions&gt;</span>
  <span class="nt">&lt;/Target&gt;</span>
  <span class="nt">&lt;Rule</span> <span class="na">RuleId=</span><span class="s">&quot;ReadRule&quot;</span> <span class="na">Effect=</span><span class="s">&quot;Permit&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Target&gt;</span>
      <span class="nt">&lt;Subjects&gt;</span>
        <span class="nt">&lt;AnySubject/&gt;</span>
      <span class="nt">&lt;/Subjects&gt;</span>
      <span class="nt">&lt;Resources&gt;</span>
        <span class="nt">&lt;AnyResource/&gt;</span>
      <span class="nt">&lt;/Resources&gt;</span>
      <span class="nt">&lt;Actions&gt;</span>
        <span class="nt">&lt;Action&gt;</span>
          <span class="nt">&lt;ActionMatch</span> <span class="na">MatchId=</span><span class="s">&quot;urn:oasis:names:tc:xacml:1.0:function:string-equal&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AttributeValue</span> <span class="na">DataType=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema#string&quot;</span><span class="nt">&gt;</span>read<span class="nt">&lt;/AttributeValue&gt;</span>
            <span class="nt">&lt;ActionAttributeDesignator</span> <span class="na">DataType=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema#string&quot;</span>
                                       <span class="na">AttributeId=</span><span class="s">&quot;urn:oasis:names:tc:xacml:1.0:action:action-id&quot;</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;/ActionMatch&gt;</span>
        <span class="nt">&lt;/Action&gt;</span>
      <span class="nt">&lt;/Actions&gt;</span>
    <span class="nt">&lt;/Target&gt;</span>
    <span class="nt">&lt;Condition</span> <span class="na">FunctionId=</span><span class="s">&quot;urn:oasis:names:tc:xacml:1.0:function:string-equal&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Apply</span> <span class="na">FunctionId=</span><span class="s">&quot;urn:oasis:names:tc:xacml:1.0:function:string-one-and-only&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;SubjectAttributeDesignator</span> <span class="na">DataType=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema#string&quot;</span>
                                    <span class="na">AttributeId=</span><span class="s">&quot;group&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/Apply&gt;</span>
      <span class="nt">&lt;AttributeValue</span> <span class="na">DataType=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema#string&quot;</span><span class="nt">&gt;</span>developers<span class="nt">&lt;/AttributeValue&gt;</span>
    <span class="nt">&lt;/Condition&gt;</span>
  <span class="nt">&lt;/Rule&gt;</span>
<span class="nt">&lt;/Policy&gt;</span>
</pre></div>
</div>
<p>The Response:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;Response&gt;</span>
  <span class="nt">&lt;Result&gt;</span>
    <span class="nt">&lt;Decision&gt;</span>Permit<span class="nt">&lt;/Decision&gt;</span>
    <span class="nt">&lt;Status&gt;</span>
      <span class="nt">&lt;StatusCode</span> <span class="na">Value=</span><span class="s">&quot;urn:oasis:names:tc:xacml:1.0:status:ok&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Status&gt;</span>
  <span class="nt">&lt;/Result&gt;</span>
<span class="nt">&lt;/Response&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="a-note-about-time-ranges">
<h3>A Note About Time Ranges<a class="headerlink" href="#a-note-about-time-ranges" title="Permalink to this headline">¶</a></h3>
<p>Time ranges represent a common access model (eg, allow access only
from 9am to 5pm). Indeed, the original version of this guide included
an example policy with exactly this constraint. The example used the
time-greater-than and time-less-than functions to define the range as
this was the standard mechanism. At first glance, this looks like a
viable solution, but in fact it doesn&#8217;t always work. The reason why is
pretty complicated, but basically the problem is that the XACML
specification references another specification for time values, and
that specification requires normalization to GMT which can shift your
time range across midnight, thus causing the greater-than or less-than
test to fail. For more detail, look in the XACML TC mailing list
archive.</p>
<p>Because supporting time ranges was an original goal in XACML, a quick
solution has been proposed: a time-in-range function. This new
function takes three time values (the moment, the lower-bound on the
range, and the upper-bound on the range), and returns true if the
moment falls between the two bounds. The semantics are such that the
range can describe any period of time less than 24 hours in duration,
and it handles time zones and normalization correctly. This problem
was not identified in time for inclusion in the 1.1 specification,
however, so it won&#8217;t be included until the 2.0 specification (though
it has been proposed as an errata against 1.1, so it should be
standardized sooner than XACML 2.0).</p>
<p>As a temporary measure, an implementation of this new function has
been implemented, but not included in the core packages. Instead, it
is included in the samples package. When this function is
standardized, it will be moved into the core code. Because this is not
a standard function yet, it is also not in the standard XACML
namespace for functions. It is in a temporary namespace which also
will be changed when the function is standardized. The bottom line is
that if you need to express time ranges in your policies then you
should use this new time-in-range function, even keeping in mind that
it&#8217;s not standard functionality yet, since it gives the proper
behavior in all time zones whereas the mechanisms in the current
specification do not.</p>
<p>As a general rule of thumb, you should take care with using the time
comparison functions. All time AttributeValues that don&#8217;t include a
time-zone will be shifted to GMT. That may cause you to cross the
midnight boundary and therefore fail the comparison test. Note that
the included module implementation for supplying the current-time
always includes the local time-zone, which makes things a little
easier.</p>
</div>
</div>
<div class="section" id="using-the-xacml-implementation">
<h2>Using The XACML Implementation<a class="headerlink" href="#using-the-xacml-implementation" title="Permalink to this headline">¶</a></h2>
<p>Everything described in the XACML overview (and much more) is
supported in this library. The rest of this guide will describe how to
use the APIs to build and customize PDPs, PEPs, or any related pieces
that fit into the XACML framework.</p>
<div class="section" id="overview-of-the-apis">
<h3>Overview Of The APIs<a class="headerlink" href="#overview-of-the-apis" title="Permalink to this headline">¶</a></h3>
<p>The APIs are broken into several packages:</p>
<ul class="simple">
<li><cite>com.sun.xacml</cite> is the core package. It contains the logic for
target matching, rule evaluation, policy and policy set handling, and
other related features. It also contains the PDP class, which is the
entry point for most code.</li>
<li><cite>com.sun.xacml.attr</cite> is the package that supports all the standard
XACML attribute data types, as well as designators, selectors, and the
factories used to create new attribute values. Standard interfaces and
abstract classes are provided to define new attributes types.</li>
<li><cite>com.sun.xacml.combine</cite> contains all of the standard combining
algorithms as well as the factory for accessing those algs. Standard
interfaces are provided for creating new combining algorithms.</li>
<li><cite>com.sun.xacml.cond</cite> provides all of the condition and function
logic, supporting all the standard functions (except the XPath
functions which, for reasons explained in the SelectorModule section,
are not included). Standard interfaces and classes are provided for
defining new functions.</li>
<li><cite>com.sun.xacml.ctx</cite> represents all of the types defined in the
context schema, ie. the request and response formats. All of these
classes are both encodable and parsable, making it easy to build a PEP
based on these classes.</li>
<li><cite>com.sun.xacml.finder</cite> provides support for retrieving things that
the PDP needs. This is used for things like finding policies,
retrieving attributes not provided in the request, resolving resource
identifiers, or generating real-time values. A set of standard classes
lets the application writer use different kinds of finder modules to
suit their tasks.</li>
<li><cite>com.sun.xacml.finder.impl</cite> has a few simple finder modules that
provide some basic functionality. Any of these can be pulled out and
replaced with better or more fully featured implementations, but they
provide enough functionality to get your PDP working without having to
write any custom finder code.</li>
<li>Also in the APIs are <cite>com.sun.xacml.attr.proxy</cite> and
<cite>com.sun.xacml.cond.cluster</cite> which are really just convenience classes
used by the configuration code. In practice these are rarely used by
programmers.</li>
</ul>
<p>This section gives an overview of how to use these APIs. For more in
depth, runnable examples, look at the samples bundle. It contains
several classes, including a command-line driven PDP app that&#8217;s useful
if you&#8217;re just getting your feet wet or if you want a quick policy
evaluator. It also contains several example policies and requests, and
the time-in-range function. Between those samples and this guide, you
should have all the examples you need to get started. If that&#8217;s not
the case, mail <a class="reference external" href="mailto:sethp&#37;&#52;&#48;users&#46;sourceforge&#46;net">the author</a> and
we&#8217;ll try to get it right next time.</p>
<p>Note that the core classes all do some logging using the standard
<cite>java.util.logging</cite> interfaces. All classes that log messages register
themselves under the name of their package and class, so (for example)
if you want to see messages from from only the core classes, you can
look for messages registered in the <cite>com.sun.xacml</cite> namespace. Logging
is done using the standard logging levels, and is categorized as
follows:</p>
<ul class="simple">
<li><strong>SEVERE:</strong> Any errors that either halt or seriously impact the
normal operation of the system (like a required config file being
unavailable)</li>
<li><strong>WARNING:</strong> Messages that may reflect some problem, but don&#8217;t
necessarily represent a problem in the system (like failure to load a
policy because of an unavailable datatype)</li>
<li><strong>INFO:</strong> Common messages that are interesting from a security or
management point of view even if they reflect normal operation (like
not finding any applicable policies or finding too many applicable
policies)</li>
<li><strong>CONFIG:</strong> Used only by startup routines (like the
ConfigurationStore)</li>
<li><strong>FINE:</strong> Any message that&#8217;s useful to people who don&#8217;t know the
details of the implementation (like the finder system being queried)</li>
<li><strong>FINER:</strong> Any message that doesn&#8217;t require detailed knowledge of
the system, but may not be important (like Target match failing)</li>
<li><strong>FINEST:</strong> Any implementation-level details that people may
actually want to consume</li>
</ul>
<p>As you write your own code to extend the core SunXACML features you
should keep these categories in mind and try to match your message
levels to these guidelines.</p>
</div>
<div class="section" id="building-a-basic-pdp">
<h3>Building a Basic PDP<a class="headerlink" href="#building-a-basic-pdp" title="Permalink to this headline">¶</a></h3>
<p>One of the more common and simple uses for this system is building a
PDP, which is a service that can handle access requests. There are two
ways to approach this. One method is to programatically create and
connect the compontents you want to use. This was the only option in
the 1.0 and 1.1 releases, and is useful if you want to have strong
control over your PDP&#8217;s functionality or if your modules require a
high degree of programmatic configuration. The other method is to use
the run-time configuration system, introduced in the 1.2 release,
which makes it easy to swap in new modules and factory configurations
and doesn&#8217;t require as much code. There are good reasons to use both
approaches. The following text outlines the first method described
above. More information about the run-time method is available in a
<a class="reference external" href="config.html">separate guide</a>. Regardless of the approach you take,
you should read the rest of this section, since it explains the
structure of modules used by the PDP.</p>
<p>In essence, a PDP is defined by the finder modules it contains. These
modules are used to access policies, retrieve attribute values, and
resolve resource hierarchies. A PDP may have any number of modules
available to it, and this will often dictate exactly how the PDP
functions. The rest of this section uses a few common modules that
will get you started. In practice, you will probably need to write at
least a few custom modules for your system based on factors like how
you manage your policies, where attribute values are available, etc.
For more on the finder module system, and how to use it to extend a
PDP, see the final section of this guide.</p>
<p>To create and configure a PDP programatically, first you need to
instantiate a set of finder modules for that PDP to use. Use of finder
modules is optional, but because they provide access to policies
(among other things), you always want to include at least one. A
sample module ( <cite>FilePolicyModule</cite>) is provided to access policies as
files, but you can write more complex modules as needed (explained
later). Note that this module is provided as a sample and as a quick
way to get started. You should not use it any real system, and you
should not count on it always being available in future releases. It
is a convenient starting point, however, and you can add as many files
to the provided module as you like.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">FilePolicyModule</span> <span class="n">policyModule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilePolicyModule</span><span class="o">();</span>
<span class="n">policyModule</span><span class="o">.</span><span class="na">addPolicy</span><span class="o">(</span><span class="s">&quot;/path/to/policy.xml&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>Note that this module will reject any policies that it can recognize
as invalid. If schema validation is being used it will reject all
invalid policies; otherwise it will catch some syntax errors, all
cases where invalid function combinations are being used, and any data
type mis-matches. Any policies that are recognized as invalid will not
be available to the PDP.</p>
<p>A finder module you should add is the <cite>CurrentEnvModule</cite>, since it
provides values for the current time, date, and dateTime. The XACML
specification requires that this information always be available
regardless of whether or not it&#8217;s provided in the request. Of course,
you can always use your own module to provide this information, but
this functionality must always be available. This module will
optionally ensure that current date/time values remain constant during
a single evaluation (this is the default behavior).</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">CurrentEnvModule</span> <span class="n">envModule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CurrentEnvModule</span><span class="o">();</span>
</pre></div>
</div>
<p>Note that a third module is provided in the
<cite>com.sun.xacml.finder.impl</cite> package. It is the <cite>SelectorModule</cite>, and
is provided for supporting AttributeSelectors (though only minimally).
This is described in greater detail in the next section.</p>
<p>The two modules created above are provided to the PDP through finders:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">PolicyFinder</span> <span class="n">policyFinder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PolicyFinder</span><span class="o">();</span>
<span class="n">Set</span> <span class="n">policyModules</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">();</span>
<span class="n">policyModules</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">policyModule</span><span class="o">);</span>
<span class="n">policyFinder</span><span class="o">.</span><span class="na">setModules</span><span class="o">(</span><span class="n">policyModules</span><span class="o">);</span>

<span class="n">AttributeFinder</span> <span class="n">attrFinder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AttributeFinder</span><span class="o">();</span>
<span class="n">List</span> <span class="n">attrModules</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
<span class="n">attrModules</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">envModule</span><span class="o">);</span>
<span class="n">attrFinder</span><span class="o">.</span><span class="na">setModules</span><span class="o">(</span><span class="n">attrModules</span><span class="o">);</span>
</pre></div>
</div>
<p>With these finders defined, we can create a new <cite>PDP</cite> and configure it
with the modules using the <cite>PDPConfig</cite> class. Note that in this case
we&#8217;re not providing a <cite>ResourceFinder</cite>, so there will be no support
for hierarchical resources (explained later), but this will be the
common behavior for most applications.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">PDP</span> <span class="n">pdp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PDP</span><span class="o">(</span><span class="k">new</span> <span class="n">PDPConfig</span><span class="o">(</span><span class="n">attrFinder</span><span class="o">,</span> <span class="n">policyFinder</span><span class="o">,</span> <span class="kc">null</span><span class="o">));</span>
</pre></div>
</div>
<p>That&#8217;s it. Now you can start processing requests, and as long as you
provided the right policy/policies to the <cite>FilePolicyModule</cite>, the
<cite>PDP</cite> will do the rest. The PDP can be queried through a <cite>RequstCtx</cite>
(which represents an XACML Request), or by using an <cite>EvaluationCtx</cite>.
The latter is what all the PDP-internal classes use, and effectively
is a more efficient representation of both the Request and the
evaluation context (ie, the Conext Handler described in the XACML
specification). There is a default implementation, but you are free to
write your own <cite>EvaluationCtx</cite>, if you like, and query the PDP with
that. The samples package contains <cite>SimplePDP</cite>, a ready to run PDP
example application, that shows these interfaces in action.</p>
<p>This distribution does not provide any kind of support for sending
requests and responses over a network (e.g., to support an online PDP
service), but it should be relatively clear how to do this. First, use
the above code (or the method described in the run-time configuration
guide) to build a PDP. Next, setup some kind of interface like a
socket, for accepting Requests and returning Responses (note you could
also invent your own wire format if you like, but it&#8217;s probably easier
to work with the standard XACML formats). Now, write a PEP (see below)
that generates the Requests, and parses back in the Responses.
Finally, plug that PEP code into your applications, and talk to an
online PDP. This can be extended further by actually sending the data
in some enveloping technology like SAML. There has been some
experimental work done on this, and the SAML 2.0 release is planning
to include a standard format for exactly this kind of interaction. For
more information, send mail to the project team.</p>
</div>
<div class="section" id="building-a-basic-pep">
<h3>Building a Basic PEP<a class="headerlink" href="#building-a-basic-pep" title="Permalink to this headline">¶</a></h3>
<p>Another common use for this implementation is building a PEP, which
interacts with a PDP by creating requests and interpreting responses.
A PEP typically interacts in an application-specific manner with its
native environment (like a server, filesystem, or other service), so
if you&#8217;re using XACML to provide access control for your system,
you&#8217;ll be writing a PEP. Because there is currently no standard way to
send XACML Requests to an online PDP, you&#8217;ll either need to include
both the PDP and PEP in the same code, or you&#8217;ll need to come up with
your own way to pass Requests and Responses. As explained above,
future versions of SAML and XACML will address this issue.</p>
<p>Most of the code that you need for building a PEP is in the
com.sun.xacml.ctx package (which represents the context schema). To
start out, create a RequestCtx instance, which represents an XACML
Request (note that the the samples package contains a full example of
how to use these APIs). The Request constructor takes four inputs,
which represent the four categories of Attributes in a Request
(Subject, Resource, Action, Environment).</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">RequestCtx</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RequestCtx</span><span class="o">(</span><span class="n">subjects</span><span class="o">,</span> <span class="n">resourceAttrs</span><span class="o">,</span>
                                    <span class="n">actionAttrs</span><span class="o">,</span> <span class="n">environmentAttrs</span><span class="o">);</span>
</pre></div>
</div>
<p>You now have a valid XACML Request that you can pass to your PDP. You
can pass that <cite>RequestCtx</cite> instance directly to a <cite>PDP</cite> like the one
created in the previous section</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">ResponseCtx</span> <span class="n">response</span> <span class="o">=</span> <span class="n">pdp</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</pre></div>
</div>
<p>or you can encode your Request and pass it to something else for
evaluation</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">OutputStream</span> <span class="n">ouput</span><span class="o">;</span> <span class="c1">// output to whatever uses the Request</span>
<span class="n">request</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">output</span><span class="o">);</span>
</pre></div>
</div>
<p>Note the return type from the call to <cite>evaluate</cite>. At some point the
Request gets evaluated by a PDP, and this results in a <cite>ResponseCtx</cite>,
which represents an XACML Response. A Response is a collection of
Results, though in practice you&#8217;ll usually only have one Result. A
Result contains the Decision, a status code, and optionally a message
or Obligations.</p>
<p>The <cite>SampleRequestBuilder</cite> class in the samples package has a complete
example of how to use these APIs, and the <cite>SimplePDP</cite> class shows a
Request being evaluated. Between these examples and the JavaDocs, it
should be pretty easy to build a simple PEP.</p>
</div>
<div class="section" id="creating-and-encoding-policies">
<h3>Creating and Encoding Policies<a class="headerlink" href="#creating-and-encoding-policies" title="Permalink to this headline">¶</a></h3>
<p>Like Requests and Responses, Policies and PolicySets can also be
created and encoded using this implementation. All policy-related
classes are immutable, but they can be created either by their
components using constructors, or through <cite>getInstance</cite> methods using
the DOM node that defines the corresponding type. This lets a program
build whole policies or just parts of policies as needed. Creating a
Policy or PolicySet is somewhat more complex than creating a Request,
so rather than walk through the example code here, a complete example
is provided as the <cite>SamplePolicyBuilder</cite> class in the samples package.
Given that, there are a few useful features to note.</p>
<p>One useful set of features are the <cite>encode</cite> methods, which can be
found on any class that represents XML-encodable data. Like Requests
and Responses, you can use the <cite>encode</cite> methods to encode a Policy or
PolicySet to its XML form. This is useful if you&#8217;re writing policy
authoring tools, code that generates policy in real time, or any
number of related systems.</p>
<p>Another useful feature set is the accessor methods on all policy-
related classes. This lets you parse a policy and then inspect it from
within your code. This kind of functionality is especially useful for
debuggers, visualizers, and other systems that require knowledge of
how policies are structured (note that you may never need to use these
interfaces if you&#8217;re only loading policies into a PDP and then
evaluating Requests). These accessors are also useful if you write
code that does dynamic policy generation based on existing policies.
For instance, if you want to write code that creates a PolicySet that
should have the same Target as some other Policy you&#8217;ve already
loaded, that&#8217;s easy using the existing APIs. This example is actually
quite common when you have PolicyFinderModules (explained in more
detail later) that need to combine policies under a single PolicySet
in real-time.</p>
<p>One final thing to note is the <cite>PolicyTreeElement</cite> interface. This is
a general interface that lets you work with the various elements of a
policy tree (Policy, PolicySet, PolicyReference, and Rule). It makes
it easy to traverse the tree, doing applicability checking and
evaluation. Programs that want to build policy sub-sets, test them,
and then continue building the policies will find this interface
particularly helpful.</p>
</div>
<div class="section" id="validating-policies-and-requests">
<h3>Validating Policies and Requests<a class="headerlink" href="#validating-policies-and-requests" title="Permalink to this headline">¶</a></h3>
<p>By default, schema validation is not done when a Request is handled,
nor does the example <cite>FilePolicyModule</cite> finder module validate by
default. This is intentional, since documents may be coming from a
source that always generates valid documents (as in the above
explanation of policy generation), or from a source that has already
validated the documents. While some basic errors will be caught by the
parsing routines even without schema checking, strict checking is not
done (in the interest of processing time, allowing applications to
build the XML in pieces, and for the reasons listed previously). So,
if you are accepting unchecked requests or policies in your PDP, you
should enable schema validation.</p>
<p>The first step in doing this is to make sure you have an XML parser
package that implements the standard <cite>jaxax.xml.parsers</cite> interfaces,
and that it supports validation. A popular example of this is the
Xerces package from Apache. Once this is in your classpath, the
standard way to set it as the XML parser to use is through the
<cite>javax.xml.parsers.DocumentBuilderFactory</cite> property. In the case of
Xerces, you would say:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">javax</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">parsers</span><span class="o">.</span><span class="na">DocumentBuilderFactory</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xerces</span><span class="o">.</span><span class="na">jaxp</span><span class="o">.</span><span class="na">DocumentBuilderFactoryImpl</span>
</pre></div>
</div>
<p>Now that this is in place, the only thing left to do is tell the PDP
to use these validating features. The easiest way to do this is by
using the <cite>com.sun.xacml.PolicySchema</cite> (if you&#8217;re using the sample
<cite>FilePolicyModule</cite> module) and <cite>com.sun.xacml.ContextSchema</cite>
properties to set the schema file locations for the policy schema and
the context schema respectively. If you want just context or just
policy validation, then only set that one property.</p>
<p>Putting all of that together, your Java invocation might look like:</p>
<div class="highlight-python"><pre>java -Djavax.xml.parsers.DocumentBuilderFactory=org.apache.xerces.jaxp.DocumentBuilderFactoryImpl
     -Dcom.sun.xacml.PolicySchema=cs-xacml-schema-policy-01.xsd
     -Dcom.sun.xacml.ContextSchema=cs-xacml-schema-context-01.xsd
     ...</pre>
</div>
<p>Now if any of the policy or request/response documents parsed are
invalid, an error will be reported, and the document will be rejected.
This does make parsing more expensive, but it also makes the PDP
safer, and guarantees that you&#8217;re working with valid inputs.</p>
</div>
<div class="section" id="supporting-attributeselectors">
<h3>Supporting AttributeSelectors<a class="headerlink" href="#supporting-attributeselectors" title="Permalink to this headline">¶</a></h3>
<p>In addition to the two modules used in the PDP example, a third module
called <cite>SelectorModule</cite> is provided for supporting the optional
AttributeSelector type. Because AttributeSelectors are an optional
part of the XACML language, you do not need to include this module to
build a conformant PDP. If you do want to support selectors, however,
you have two choices: include this module, or write your own.</p>
<p>The <cite>SelectorModule</cite> uses Xalan from Apache for XPath support, so if
you&#8217;re going to use this module, you&#8217;ll have to download the Xalan
package or use a JDK that supports these routines. Specifically, the
module uses the <cite>org.apache.xpath.XPathAPI</cite> class. At present, there
is no standard Java API for XPath queries, but when one becomes
available, this module will be changed to use that interface.</p>
<p>A note about the provided <cite>SelectorModule</cite>: as the JavaDoc says, this
class is provided as a separate module rather than core functionality
(like the <cite>AttributeDesignator</cite>) expressly so that it&#8217;s easy to pull
out of a PDP. Because it&#8217;s optional functionality, and because XPath
queries are expensive operations, a PDP may want to exclude this
functionality. However, this module is not particularly efficient, and
it is tied to a particular XPath library, so for these reasons also
you may want to exclude this module. The module will work perfectly
well for simple cases, but for a more robust PDP you should consider
writing your own module to support AttributeSelectors.</p>
<p>One final issue to consider is namespace handling. The
<cite>SelectorModule</cite> tries to use the namespace definitions from the root
of the policy document that contains the selector invoking the module.
If namespaces are used in the XPath expression, then they will be
mapped from the policy and used in the query. If no namespaces are
used in the Request, then there should be no namespace mappings in the
XPath expression. Beyond that, the implementation doesn&#8217;t try to do
anything fancier (like add default namespaces if none are used, or
walk the tree looking for namespace mappings in nodes other than the
root). In practice you shouldn&#8217;t need this kind of functionality, but
if you find that you do, then you should consider implementing your
own module to support AttributeSelectors.</p>
</div>
<div class="section" id="getting-and-building-the-implementation">
<h3>Getting and Building the Implementation<a class="headerlink" href="#getting-and-building-the-implementation" title="Permalink to this headline">¶</a></h3>
<p>The distribution packages contain the code used to build that release.
If you want to get the latest code, however, you&#8217;ll need to get it
from the CVS tree. The code in the CVS tree is always tested, and is
usually at least as stable as the code included in each release, but
it may contain changes that are incompatible with past releases. It
may also conflict with the sample code and the explanations in this
guide, so care should be taken when using the latest code. You can get
the code using anonymous CVS (the CVS download page explains this).
You can also grab <a href="#id1"><span class="problematic" id="id2">`</span></a>nightly tarballs of the CVS tree.</p>
<p>The distribution packages also contain built jar files, but to keep up
with the latest changes you may want to build the code yourself.
Building the code included in the releases and building the code from
the CVS tree works the same way, and is fairly simple. The build
process uses <a class="reference external" href="http://ant.apache.org">Ant</a>, a cross-platform build
system. The default target builds the code into a <cite>build</cite> directory.
There is also a <cite>doc</cite> target to build the JavaDocs, and a <cite>jar</cite> target
to build a jar file of the code. Note that the code is built with
debugging on, which is what most people who are building the code
themselves want.</p>
</div>
<div class="section" id="testing-the-implementation">
<h3>Testing the Implementation<a class="headerlink" href="#testing-the-implementation" title="Permalink to this headline">¶</a></h3>
<p>The XACML TC has defined a set of conformance tests to help promote
interoperability. The tests are defined as paired Requests and
Policies, and the expected Response from evaluating those pairs. Some
of the test cases are fairly basic, while others require custom
functionality in the PDP and/or Context Handler. To run these test
cases, there is a very simple test package included with this project.
The test package&#8217;s readme explains what you need to do to run the
tests.</p>
<p>Note that there are currently no regression tests, input/output tests,
or other formal tests available as part of this project. Mostly this
is because no one has had the time to build these into the testing
framework. If you&#8217;re interested in helping to remedy this situation,
please let us know!</p>
</div>
</div>
<div class="section" id="extending-the-xacml-implementation">
<h2>Extending The XACML Implementation<a class="headerlink" href="#extending-the-xacml-implementation" title="Permalink to this headline">¶</a></h2>
<p>Now that you&#8217;ve seen how to work with the basic components, the next
sections will deal with how to extend the system. This covers most of
the interfaces and factories, and talks about how to include new
attributes, functions, combining algorithms, and finder modules.</p>
<div class="section" id="working-with-the-factories">
<h3>Working With The Factories<a class="headerlink" href="#working-with-the-factories" title="Permalink to this headline">¶</a></h3>
<p>As is explained in the next three sections, a simple system of
factories is used to support all datatypes, functions, and combining
algorithms. In the 1.0 and 1.1 releases the factory system was
extremely simple: each factory was a singleton with static interfaces,
and modifying the factory affected all users. Also, there was no
mechanism for defining your own factory implementation. With the 1.2
release this has improved: a single static default instance is
available, but you can swap in new default factories for the core code
to use. Also, there are now generic factory instances, so you can
define your own implementations of factories and use those in your
code. The run-time configuration system supports this too.</p>
<p>Because the 1.0/1.1 factory system supported only a single factory
instance for each kind of factory, there was no way to support
different factories for different uses, and modifying a factory in one
section of code affected all other code. In the 1.2 release this has
improved, since you can now work with multiple factory instances. You
stil define a single, global default factory that is used by the core
code, however, so only half the problem is solved. The reason for this
is that it will require changes to many interfaces to support the
&#8220;right&#8221; functionality. Since the 2.0 release will require exactly
these kinds of changes (because it will be supporting multiple
versions of the XACML schema), the interfaces will be changed then to
pair identifiable factories with PDPs. This will give the system full
safety with the factories. Until then, care should still be taken when
modifying the default factories.</p>
<p>A related problem in the 1.0 and 1.1 releases was, because there was
only one instance of each kind of factory, you could modify the
standard functionality and create non-standard factories. This has
been fixed in the 1.2 release. Specifically, standard functionality is
now supported by a specific instance of each kind of factory (for
instance, the <cite>com.sun.xacml.attr.StandardAttributeFactory</cite>) and these
standard factories are immutable. You cannot add to or remove from
these factories (doing so will throw an exception). This ensures that
you can ask for a factory supporting only standard functionality, and
that it won&#8217;t at some future time also support custom functionality.</p>
<p>Note that the system starts with standard factories as the default.
This means that you cannot simply ask for the default factory and then
add to it. If you want the standard functionality, but want to augment
it with some new datatype, function, or algorithm, then you should
first create a new factory instance supporting the same standard
functionality. This is easy to do. For datatypes</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">StandardAttributeFactory</span> <span class="n">standardFactory</span> <span class="o">=</span>
    <span class="n">StandardAttributeFactory</span><span class="o">.</span><span class="na">getFactory</span><span class="o">();</span>
<span class="kd">final</span> <span class="n">BaseAttributeFactory</span> <span class="n">newFactory</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nf">BaseAttributeFactory</span><span class="o">(</span><span class="n">standardFactory</span><span class="o">.</span><span class="na">getStandardDatatypes</span><span class="o">());</span>
<span class="o">...</span>
<span class="c1">// modify the contents of the new factory</span>
<span class="o">...</span>
<span class="n">AttributeFactory</span><span class="o">.</span><span class="na">setDefaultFactory</span><span class="o">(</span><span class="k">new</span> <span class="n">AttributeFactoryProxy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">AttributeFactory</span> <span class="nf">getFactory</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">newFactory</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">});</span>
</pre></div>
</div>
<p>and combining algorthms</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">StandardCombiningAlgFactory</span> <span class="n">standardFactory</span> <span class="o">=</span>
    <span class="n">StandardCombiningAlgFactory</span><span class="o">.</span><span class="na">getFactory</span><span class="o">();</span>
<span class="kd">final</span> <span class="n">BaseCombiningAlgFactory</span> <span class="n">newFactory</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nf">BaseCombiningAlgFactory</span><span class="o">(</span><span class="n">standardFactory</span><span class="o">.</span><span class="na">getStandardAlgorithms</span><span class="o">());</span>
<span class="o">...</span>
<span class="c1">// modify the contents of the new factory</span>
<span class="o">...</span>
<span class="n">CombiningAlgFactory</span><span class="o">.</span><span class="na">setDefaultFactory</span><span class="o">(</span><span class="k">new</span> <span class="n">CombiningAlgFactoryProxy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">CombiningAlgFactory</span> <span class="nf">getFactory</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">newFactory</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">});</span>
</pre></div>
</div>
<p>it looks pretty much the same. Functions are handled differently,
since they&#8217;re more complex, so a convenience method is provided to
help you out</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">FunctionFactoryProxy</span> <span class="n">proxy</span> <span class="o">=</span> <span class="n">StandardFunctionFactory</span><span class="o">.</span><span class="na">getNewFactoryProxy</span><span class="o">();</span>
<span class="o">...</span>
<span class="c1">// modify the contents of the new factory through the proxy</span>
<span class="o">...</span>
<span class="n">FunctionFactory</span><span class="o">.</span><span class="na">setDefaultFactory</span><span class="o">(</span><span class="n">proxy</span><span class="o">);</span>
</pre></div>
</div>
<p>In the following sections, the assumption is that the factories being
modified have been setup in this manner.</p>
<p>With the addition of a generic interface for creating new factory
implementations, new base implementations were added (along the lines
of the <cite>FunctionBase</cite> class). These are basically convenience classes
that implement the basic functionality that most people need for these
factories. If you are implementing a new factory, consider using these
base implementations as a starting point.</p>
<p>One final note about the factory interfaces: in the interest of
keeping the interfaces as stable as possible from past releases to
this release, all of the original static interfaces on
<cite>AttributeFactory</cite>, <cite>FunctionFactory</cite>, and <cite>CombiningAlgFactory</cite> have
been left intact and functional. They will still operate on the
default factories. Many of these methods, however, have been
deprecated, and they will be removed with the 2.0 release. They are
also much slower in their new form. It is strongly recommended,
therefore, that if you are currently using any of these interfaces you
switch to using the new methods. Mostly, this involes asking for a
factory instance (see the examples in the following three sections)
and operating on it, rather than simply using the static intarfaces on
the base factory classes. For more details, look at the javadocs for
information about what has been deprecated and what methods are now
recommended.</p>
</div>
<div class="section" id="adding-new-attribute-types">
<h3>Adding New Attribute Types<a class="headerlink" href="#adding-new-attribute-types" title="Permalink to this headline">¶</a></h3>
<p>XACML supports many common datatypes by default, including strings,
integers, email addresses, dates, and URIs. Because all attributes in
XACML specify their type, however, it&#8217;s easy to define new types and
include values of these types in standard policies and
requests/responses. Adding support for a new datatype to your PDP is
almost as easy, though it requires a little more work.</p>
<p>All attribute types are represented as subclasses of the abstract
<cite>AttributeValue</cite>. To create a new type, therefore, you start by
creating a new class that extends <cite>AttributeValue</cite>, you provide the
type&#8217;s identifier, and then implement the encode method as well as
equals and hashCode (from <cite>Object</cite>). The other methods all have
default behavior that will be correct for most types. Here is an
example of an attribute that represents a simple string value:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NewAttribute</span> <span class="kd">extends</span> <span class="n">AttributeValue</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TYPE</span> <span class="o">=</span> <span class="s">&quot;newType&quot;</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">NewAttribute</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">URISyntaxException</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="k">new</span> <span class="n">URI</span><span class="o">(</span><span class="n">TYPE</span><span class="o">));</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">encode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p>Now that there is a class that supports the new type, it needs to be
added to the <cite>AttributeFactory</cite> using an <cite>AttributeProxy</cite>. The proxy
is called each time a new value is created. Typically you just use an
anonymous class to support the new type, and then have that class call
constructors or methods to get new instances of the new type:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">AttributeFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">AttributeFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
<span class="n">factory</span><span class="o">.</span><span class="na">addDatatype</span><span class="o">(</span><span class="s">&quot;newType&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeProxy</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">AttributeValue</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">Node</span> <span class="n">root</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
            <span class="c1">// this method is not implemented in the previous example,</span>
            <span class="c1">// but would simply pull the data out of the node, validate</span>
            <span class="c1">// the data, and then create a new NewAttribute</span>
            <span class="k">return</span> <span class="n">NewAttribute</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">root</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">AttributeValue</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">NewAttribute</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">});</span>
</pre></div>
</div>
<p>Of course, if you wanted, you could make a more complex proxy, but
this is really all that a proxy needs to do. At this point, if the
<cite>AttributeFactory</cite> is asked to create a value of type &#8220;newType&#8221;, it
will call one of the two proxy methods (based on how the factory was
invoked).</p>
</div>
<div class="section" id="adding-new-functions">
<h3>Adding New Functions<a class="headerlink" href="#adding-new-functions" title="Permalink to this headline">¶</a></h3>
<p>Just as with attributes, XACML includes standard support for a wide
variety of functions from simple boolean operations (like integer-
equal, and/or/not, date-less-than, etc.) to complex Set and Bag-
related functions. There are even functions that let you do set
mappings using other functions as transforms. Should this fairly large
set of functions not be sufficient, however, you can write new
functions and make them available for any policy to use.</p>
<p>All functions implement the <cite>Function</cite> interface, though a
<cite>FunctionBase</cite> helper class, which implements some common
functionality, is provided if you don&#8217;t need to do anything too
complex in your new function. The JavaDocs in <cite>Function</cite> spell out
what is expected of any new function. Basically, a function can be
evaluated against a set of inputs, can be asked if a set of inputs is
acceptable, and provides information about its return type and
identity.</p>
<p>The <cite>FunctionBase</cite> helper class may be useful if you&#8217;re writing a
function that has predefined input and output types and/or if it
doesn&#8217;t need to do any special checking when validating parameters
(see the JavaDocs for more specifics). The <cite>FunctionBase</cite> implements
most of the required methods, leaving a custom function needing to
implement only the evaluation method. For instance, suppose you want
to write a new function that takes a boolean and a string, and
compares them to see if text of the string is equal to the value of
the boolean. Using the <cite>FunctionBase</cite> helper class, this is a pretty
easy task.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoolTextCompare</span> <span class="kd">extends</span> <span class="n">FunctionBase</span> <span class="o">{</span>

    <span class="c1">// the name of the function, which will be used publicly</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">NAME</span> <span class="o">=</span> <span class="s">&quot;bool-text-compare&quot;</span><span class="o">;</span>

    <span class="c1">// the parameter types, in order, and whether or not they&#39;re bags</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">params</span> <span class="o">[]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">BooleanAttribute</span><span class="o">.</span><span class="na">identifier</span><span class="o">,</span>
                                              <span class="n">StringAttribute</span><span class="o">.</span><span class="na">identifier</span> <span class="o">};</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">bagParams</span> <span class="o">[]</span> <span class="o">=</span> <span class="o">{</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span> <span class="o">};</span>

    <span class="kd">public</span> <span class="nf">BoolTextCompare</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// use the constructor that handles mixed argument types</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">NAME</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">params</span><span class="o">,</span> <span class="n">bagParams</span><span class="o">,</span> <span class="n">BooleanAttribute</span><span class="o">.</span><span class="na">identifier</span><span class="o">,</span>
              <span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">EvaluationResult</span> <span class="nf">evaluate</span><span class="o">(</span><span class="n">List</span> <span class="n">inputs</span><span class="o">,</span> <span class="n">EvaluationCtx</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Evaluate the arguments using the helper method...this will</span>
        <span class="c1">// catch any errors, and return values that can be compared</span>
        <span class="n">AttributeValue</span> <span class="o">[]</span> <span class="n">argValues</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">[</span><span class="n">inputs</span><span class="o">.</span><span class="na">size</span><span class="o">()];</span>
        <span class="n">EvaluationResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">evalArgs</span><span class="o">(</span><span class="n">inputs</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="n">argValues</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>

        <span class="c1">// cast the resolved values into specific types</span>
        <span class="n">BooleanAttribute</span> <span class="n">bool</span> <span class="o">=</span> <span class="o">(</span><span class="n">BooleanAttribute</span><span class="o">)(</span><span class="n">argValues</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
        <span class="n">StringAttribute</span> <span class="n">str</span> <span class="o">=</span> <span class="o">(</span><span class="n">StringAttribute</span><span class="o">)(</span><span class="n">argValues</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
        <span class="kt">boolean</span> <span class="n">evalResult</span><span class="o">;</span>

        <span class="c1">// now compare the values</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">bool</span><span class="o">.</span><span class="na">getValue</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// see if the string is &quot;true&quot;</span>
            <span class="n">evalResult</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;true&quot;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// see if the string is &quot;false&quot;</span>
            <span class="n">evalResult</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;false&quot;</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// boolean returns are common, so there&#39;s a getInstance() for that</span>
        <span class="k">return</span> <span class="n">EvaluationResult</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">evalResult</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now you just need to add this function into the factory. The
<cite>FunctionFactory</cite> is split into three groups, providing different
categories of functions (explained in detail in the JavaDocs). In this
case, we&#8217;ve written a boolean function that should be available to any
part of the system, so it gets added to the factory as a Target
function (since it can be used in a Target, a Condition, or in any
general situation). Most functions are singletons (since most don&#8217;t
need state so it saves time and memory), so to add the function, you
instantiate it and pass it into the factory:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">FunctionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">FunctionFactory</span><span class="o">.</span><span class="na">getTargetInstance</span><span class="o">();</span>
<span class="n">factory</span><span class="o">.</span><span class="na">addFunction</span><span class="o">(</span><span class="k">new</span> <span class="n">BoolTextCompare</span><span class="o">());</span>
</pre></div>
</div>
<p>In addition to writing new functions from scratch, certain functions
can be added when new attribute types are introduced. The standard Bag
and Set functions, as well as the Equal function are all functions
that can work on any datatype. When a new attribute type is created
(as described in the previous section), it can be used with these
standard functions quite easily. A name has to be chosen, and then the
function is created and added to the factory. For instance, if you
wanted to be able to do equality checking in a policy on the
NewAttribute type created in the previous example, you would configure
your factory:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">FunctionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">FunctionFactory</span><span class="o">.</span><span class="na">getTargetInstance</span><span class="o">();</span>
<span class="n">factory</span><span class="o">.</span><span class="na">addFunction</span><span class="o">(</span><span class="k">new</span> <span class="n">EqualFunction</span><span class="o">(</span><span class="s">&quot;newAttribute-equal&quot;</span><span class="o">,</span>
                                      <span class="n">NewAttribute</span><span class="o">.</span><span class="na">TYPE</span><span class="o">));</span>
</pre></div>
</div>
<p>Now you can use the &#8220;newAttribute-equal&#8221; function in a policy.
Likewise, the <cite>BagFunction</cite> and <cite>SetFunction</cite> classes provide several
methods for creating new instances that use new attribute types. The
[type]-one-and-only function is almost always a function that you want
to include for your new type. To do this, you configure the factory
the same way:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">FunctionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">FunctionFactory</span><span class="o">.</span><span class="na">getGeneralInstance</span><span class="o">();</span>
<span class="n">factory</span><span class="o">.</span><span class="na">addFunction</span><span class="o">(</span>
    <span class="n">BagFunction</span><span class="o">.</span><span class="na">getOneAndOnlyInstance</span><span class="o">(</span><span class="s">&quot;newAttribute-one-and-only&quot;</span><span class="o">,</span>
                                      <span class="n">NewAttribute</span><span class="o">.</span><span class="na">TYPE</span><span class="o">));</span>
</pre></div>
</div>
<p>Now the PDP knows about the &#8220;newAttribute-one-and-only&#8221; function which
can be used as a wrapper around an AttributeDesignator to get single
values of the newAttribute type. Note that the higher order bag
functions will also be able to use new attribute types, but because of
how they work, you don&#8217;t need to explicitly install new instances for
new attribute types.</p>
<p>One final kind of function is an abstract function. These are
functions that keep some state and therefore can&#8217;t be completely
constructed until they are provided some information from a policy. An
example from the specification is the map function, which derives its
return type from its parameters. Unlike regular functions, these are
not singletons, and they are created as needed within a policy. The
<cite>FunctionBase</cite> may be useful for abstract functions, but if the
functions don&#8217;t know what types they accept or return (often the case
for these functions), they&#8217;re better off being defined directly from
the <cite>Function</cite> interface.</p>
<p>Like attributes, abstract functions are used by giving the
<cite>FunctionFactory</cite> a proxy that is called each time a new instance is
needed. The proxy&#8217;s <cite>getInstance</cite> method is passed a DOM node that
contains the given function (typically an ApplyType), and returns a
<cite>Function</cite> based on the data in that node. Because this is a somewhat
expensive operation, these functions should be used only when a
regular function cannot be used. The only standard function provided
as an abstract function is the map function. For more on how to
install and create these functions, see the JavaDocs for
<cite>FunctionFactory</cite>.</p>
</div>
<div class="section" id="adding-new-combining-algorithms">
<h3>Adding New Combining Algorithms<a class="headerlink" href="#adding-new-combining-algorithms" title="Permalink to this headline">¶</a></h3>
<p>Combining Algorithms come in two flavors: Policy Combining Algorithms
and Rule Combining Algorithms. Each of these is represented by an
abstract class that is extended to define a new algorithm. While both
classes have a single <cite>combine</cite> method, the two types of algorithms
are expected to do somewhat different things.</p>
<p>To create a new Rule Combining Algorithm you need to extend
<cite>RuleCombiningAlgorithm</cite> and implement its one method. The <cite>combine</cite>
method takes the context and a list of rules (in order), and returns a
single Result. All that a Rule Combining Algorithm is expected to do
with the rules is evaluate each one, interpreting the result as
appropriate. For example, you might write a &#8220;PermitOrDeny&#8221; rule that
returns Permit if any Rule returns Permit, and otherwise always
returns Deny. The code will evaluate each Rule, looking at the result,
and then decide whether or not to keep going.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PermitOrDenyRuleAlg</span> <span class="kd">extends</span> <span class="n">RuleCombiningAlgorithm</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">PermitOrDenyRuleAlg</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">URISyntaxException</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="k">new</span> <span class="n">URI</span><span class="o">(</span><span class="s">&quot;rule-combining-alg:permit-or-deny&quot;</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Result</span> <span class="nf">combine</span><span class="o">(</span><span class="n">EvaluationCtx</span> <span class="n">context</span><span class="o">,</span> <span class="n">List</span> <span class="n">rules</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// get the next Rule, and evaluate it</span>
            <span class="n">Rule</span> <span class="n">rule</span> <span class="o">=</span> <span class="o">(</span><span class="n">Rule</span><span class="o">)(</span><span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
            <span class="n">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>

            <span class="c1">// if it returns Permit, then the alg returns Permit</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getDecision</span><span class="o">()</span> <span class="o">==</span> <span class="n">Result</span><span class="o">.</span><span class="na">DECISION_PERMIT</span><span class="o">)</span>
                <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">// if nothing returned Permit, then the alg returns Deny</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Result</span><span class="o">(</span><span class="n">Result</span><span class="o">.</span><span class="na">DECISION_DENY</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p>To create a new Policy Combining Algorithm, you need to do a little
more work. Start by extending <cite>PolicyCombiningAlgorithm</cite>, and again
implement the single <cite>combine</cite> method. Now, in addition to evaluating
each policy, you must first check that the policy applies (Rules check
applicability when evaluated, but policies do not for various
performance reasons). The algorithm must also handle Obligations
correctly, ensuring that the correct obligations are returned. This
issue is discussed in great detail in the XACML specification, and to
a lesser degree, in the JavaDocs. The general rule is that you always
return any Obligations that were considered during evaluation and that
have the same Effect that the combining algorithm is returning. Taking
the same &#8220;PermitOrDeny&#8221; example used above, the Policy Combining
Algorithm will look similar with the additional steps described here.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PermitOrDenyPolicyAlg</span> <span class="kd">extends</span> <span class="n">PolicyCombiningAlgorithm</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">PermitOrDenyPolicyAlg</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">URISyntaxException</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="k">new</span> <span class="n">URI</span><span class="o">(</span><span class="s">&quot;policy-combining-alg:permit-or-deny&quot;</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Result</span> <span class="nf">combine</span><span class="o">(</span><span class="n">EvaluationCtx</span> <span class="n">context</span><span class="o">,</span> <span class="n">List</span> <span class="n">policies</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Set</span> <span class="n">denyObligations</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">();</span>
        <span class="n">Iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">policies</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// get the next AbstractPolicy, and match it</span>
            <span class="n">AbstractPolicy</span> <span class="n">policy</span> <span class="o">=</span> <span class="o">(</span><span class="n">AbstractPolicy</span><span class="o">)(</span><span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
            <span class="n">MatchResult</span> <span class="n">match</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>

            <span class="c1">// see if the AbstractPolicy policy applies...</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">match</span><span class="o">.</span><span class="na">getResult</span><span class="o">()</span> <span class="o">==</span> <span class="n">MatchResult</span><span class="o">.</span><span class="na">MATCH</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// ...and if it does, evaluate it</span>
                <span class="n">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>

                <span class="c1">// if it returns Permit, then the alg returns Permit</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getDecision</span><span class="o">()</span> <span class="o">==</span> <span class="n">Result</span><span class="o">.</span><span class="na">DECISION_PERMIT</span><span class="o">)</span>
                    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>

                <span class="c1">// if it returns Deny, save the Obligations for later</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getDecision</span><span class="o">()</span> <span class="o">==</span> <span class="n">Result</span><span class="o">.</span><span class="na">DECISION_DENY</span><span class="o">)</span>
                    <span class="n">denyObligations</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getObligations</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">// if nothing matched and returned Permit, then the alg</span>
        <span class="c1">// returns Deny, including all Deny Obligations</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Result</span><span class="o">(</span><span class="n">Result</span><span class="o">.</span><span class="na">DECISION_DENY</span><span class="o">,</span> <span class="n">denyObligations</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p>Note that both of these examples are fairly simple, and don&#8217;t look for
Indeterminate returns from matching or evaluating. Often a Combining
Algorithm will want to take special actions when these errors occur,
either at the moment they happen, or if the algorithm makes it all the
way to the end of the list of rules or policies. For instance, if an
error occurred when trying to match a policy, then you can&#8217;t really
trust a final result of Deny, since had the matching operation
succeeded, it might have a found a policy that returned Permit on
evaluation, which would change the final result. These algorithms can
be somewhat tricky, so before you try to write your own, you should
probably look at the source code for the standard algorithms in the
<cite>combine</cite> package for guidance.</p>
<p>The last step is to include the new algorithms in the
<cite>CombiningAlgFactory</cite>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">CombiningAlgFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">CombiningAlgFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
<span class="n">factory</span><span class="o">.</span><span class="na">addAlgorithm</span><span class="o">(</span><span class="k">new</span> <span class="n">PermitOrDenyRuleAlg</span><span class="o">());</span>
<span class="n">factory</span><span class="o">.</span><span class="na">addAlgorithm</span><span class="o">(</span><span class="k">new</span> <span class="n">PermitOrDenyPolicyAlg</span><span class="o">());</span>
</pre></div>
</div>
<p>Like with Functions, there is only one instance of each Combining
Algorithm since they don&#8217;t keep any state.</p>
</div>
<div class="section" id="adding-new-finder-modules">
<h3>Adding New Finder Modules<a class="headerlink" href="#adding-new-finder-modules" title="Permalink to this headline">¶</a></h3>
<p>You&#8217;ve already seen how to create instances of finder modules, and how
to include specific sets of finder modules in a PDP. Since you may
want to write new modules, however, there are APIs to define new
modules, and those modules are included in a PDP in the same manner
that has already been discussed. There are three types of finder
modules: attribute finder modules, policy finder modules, and resource
finder modules. Note that these can get complex, especially given the
rules laid down by the XACML specification, so you should read the
JavaDocs carefully before trying to write one of these modules.</p>
<p>Attribute finder modules are used when an attribute value can&#8217;t be
found in the request. They are called from a designator or selector,
and so there are two methods for finding values, one of which takes
the fields used in a designator and the other which accepts an XPath
expression. There are also methods used to specify which of those two
retrieval methods (or both) are supported by a given module, and what
types of attributes can be found using a designator. This information
is used by the <cite>AttributeFinder</cite> to decide which modules to use for
any given query.</p>
<p>Policy finder modules are used both to find Policies for a given
request and to find Policies referenced from PolicySets. Like
attribute modules, there are different methods for the different types
of retrieval, and there are also methods that let the module specify
which kinds of retrieval are supported. There are several rules about
policy retrieval, most important of which is that a policy module may
never find more than one matching policy. If it does, this is an error
and must be reported. Decisions like whether or not to cache policies
and whether to add support for signed policies are up to the
implementor.</p>
<p>Resource finder modules are used by a feature of XACML called
hierarchical resources. A request must name a resource, but that
resource might be specified as the root of a hierarchy of other
resources, like a filesystem or XML document. If the resource is
specified as hierarchical, the <cite>ResourceFinder</cite> is used to get the
complete list of resource identifiers associated with the root
resource. Because of the potential for abuse of this feature, and
because the specification doesn&#8217;t include any specific requirements
for what kinds of hierarchies must be supported, there are no resource
modules included in this distribution.</p>
<p>Resource hierarchies are, perhaps, one of the most mis-understood
features of XACML. Basically, they let you request access to more than
one resource, as long as the resources are in some simple hierarchy.
The resulting Response will contain a separate Result for each of the
resources in the hierarchy. To make this happen, specify the root of
the hierarchy in the standard resource-id attribute, and then include
the standard scope attribute with a value of either &#8220;Children&#8221; or
&#8220;Descendants&#8221; (for details, look at the javadocs for <cite>ResourceFinder</cite>
and <cite>EvaluationCtx</cite>). If you supply a <cite>ResourceFinderModule</cite> that can
handle the hierarchy, then it will be queried for all the resources
under the root resource, and each resource will result in a separate
Request to the PDP. This guide doesn&#8217;t go into more detail on this
topic since few people actually need this feature, and since XACML 2.0
will introduce a much clearer and more powerful system for handling
this kind of fucntionality.</p>
<p>Finally, here is a simple example of how to write a custom
<cite>AttributeFinderModule</cite> (writing other modules looks very similar, and
the com.sun.xacml.finder.impl package provides more examples, as does
the test code, which relies on custom finders to pass all the tests).
In this example, a module is provided that can get the current
processor load (a measure of how busy the CPU is right now), which
might be useful for determining whether or not a new application is
allowed to run on this host, or even if another intensive session
(like an encrypted channel) should be opened. Note that this value
isn&#8217;t being returned to the PEP, so there&#8217;s not much security risk in
providing this module. It&#8217;s simply providing another real-time piece
of data that policies can use to make informed decisions. The module
itself is pretty simple: it announces its capabilities, and when
called to find a value it checks first to see that it&#8217;s being called
for the attribute it knows about.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoadEnvModule</span> <span class="kd">extends</span> <span class="n">AttributeFinderModule</span> <span class="o">{</span>

    <span class="c1">// always return true, since this is a feature we always support</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isDesignatorSupported</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// return a single identifier that shows support for environment attrs</span>
    <span class="kd">public</span> <span class="n">Set</span> <span class="nf">getSupportedDesignatorTypes</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Set</span> <span class="n">set</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">();</span>
        <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">AttributeDesignator</span><span class="o">.</span><span class="na">ENVIRONMENT_TARGET</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">EvaluationResult</span> <span class="nf">findAttribute</span><span class="o">(</span><span class="n">URI</span> <span class="n">attributeType</span><span class="o">,</span>
                                          <span class="n">URI</span> <span class="n">attributeId</span><span class="o">,</span>
                                          <span class="n">URI</span> <span class="n">issuer</span><span class="o">,</span> <span class="n">URI</span> <span class="n">subjectCategory</span><span class="o">,</span>
                                          <span class="n">EvaluationCtx</span> <span class="n">context</span><span class="o">,</span>
                                          <span class="kt">int</span> <span class="n">designatorType</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// make sure this is an Environment attribute</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">designatorType</span> <span class="o">!=</span> <span class="n">AttributeDesignator</span><span class="o">.</span><span class="na">ENVIRONMENT_TARGET</span><span class="o">)</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">EvaluationResult</span><span class="o">(</span><span class="n">BagAttribute</span><span class="o">.</span>
                                        <span class="n">createEmptyBag</span><span class="o">(</span><span class="n">attributeType</span><span class="o">));</span>

        <span class="c1">// make sure they&#39;re asking for our identifier</span>
        <span class="k">if</span> <span class="o">(!</span> <span class="n">attributeId</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;processor-load&quot;</span><span class="o">))</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">EvaluationResult</span><span class="o">(</span><span class="n">BagAttribute</span><span class="o">.</span>
                                        <span class="n">createEmptyBag</span><span class="o">(</span><span class="n">attributeType</span><span class="o">));</span>

        <span class="c1">// make sure they&#39;re asking for an integer return value</span>
        <span class="k">if</span> <span class="o">(!</span> <span class="n">attributeType</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">IntegerAttribute</span><span class="o">.</span><span class="na">identifier</span><span class="o">))</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">EvaluationResult</span><span class="o">(</span><span class="n">BagAttribute</span><span class="o">.</span>
                                        <span class="n">createEmptyBag</span><span class="o">(</span><span class="n">attributeType</span><span class="o">));</span>

        <span class="c1">// now that everything checks out, get the load...</span>
        <span class="kt">long</span> <span class="n">procLoad</span> <span class="o">=</span> <span class="n">someMethodToCalculateProcessorLoad</span><span class="o">();</span>

        <span class="c1">// ... and return that value</span>
        <span class="n">Set</span> <span class="n">set</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">();</span>
        <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">IntegerAttribute</span><span class="o">(</span><span class="n">procLoad</span><span class="o">));</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">EvaluationResult</span><span class="o">(</span><span class="k">new</span> <span class="n">BagAttribute</span><span class="o">(</span><span class="n">attributeType</span><span class="o">,</span> <span class="n">set</span><span class="o">));</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p>The final step is to install this module as was explained back in the
section on building a PDP. With this module in place, a policy can now
include:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;EnvironmentAttributeSelector</span> <span class="na">DataType=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema#integer&quot;</span>
                              <span class="na">AttributeId=</span><span class="s">&quot;processor-load&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Send comments, questions, and corrections to`seth proctor
&lt;<a class="reference external" href="mailto:sethp&#37;&#52;&#48;users&#46;sourceforge&#46;net">mailto:sethp<span>&#64;</span>users<span>&#46;</span>sourceforge<span>&#46;</span>net</a>&gt;`__.</p>
<p>Copyright 2003-2004 Sun Microsystems, Inc. All rights reserved. Use is
subject to license terms.</p>
<p>Sun, Sun Microsystems, the Sun Logo, and Java are trademarks or
registered trademarks of Sun Microsystems, Inc. in the US and other
countries.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Programmer&#8217;s Guide for Version 1.2</a><ul>
<li><a class="reference external" href="#introduction">Introduction</a></li>
<li><a class="reference external" href="#a-brief-introduction-to-xacml">A Brief Introduction to XACML</a><ul>
<li><a class="reference external" href="#top-level-constructs-policy-and-policyset">Top-Level Constructs: Policy and PolicySet</a></li>
<li><a class="reference external" href="#targets-and-rules">Targets and Rules</a></li>
<li><a class="reference external" href="#attributes-attribute-values-and-functions">Attributes, Attribute Values, and Functions</a></li>
<li><a class="reference external" href="#requests-and-responses">Requests and Responses</a></li>
<li><a class="reference external" href="#putting-it-together-an-example">Putting it Together: An Example</a></li>
<li><a class="reference external" href="#a-note-about-time-ranges">A Note About Time Ranges</a></li>
</ul>
</li>
<li><a class="reference external" href="#using-the-xacml-implementation">Using The XACML Implementation</a><ul>
<li><a class="reference external" href="#overview-of-the-apis">Overview Of The APIs</a></li>
<li><a class="reference external" href="#building-a-basic-pdp">Building a Basic PDP</a></li>
<li><a class="reference external" href="#building-a-basic-pep">Building a Basic PEP</a></li>
<li><a class="reference external" href="#creating-and-encoding-policies">Creating and Encoding Policies</a></li>
<li><a class="reference external" href="#validating-policies-and-requests">Validating Policies and Requests</a></li>
<li><a class="reference external" href="#supporting-attributeselectors">Supporting AttributeSelectors</a></li>
<li><a class="reference external" href="#getting-and-building-the-implementation">Getting and Building the Implementation</a></li>
<li><a class="reference external" href="#testing-the-implementation">Testing the Implementation</a></li>
</ul>
</li>
<li><a class="reference external" href="#extending-the-xacml-implementation">Extending The XACML Implementation</a><ul>
<li><a class="reference external" href="#working-with-the-factories">Working With The Factories</a></li>
<li><a class="reference external" href="#adding-new-attribute-types">Adding New Attribute Types</a></li>
<li><a class="reference external" href="#adding-new-functions">Adding New Functions</a></li>
<li><a class="reference external" href="#adding-new-combining-algorithms">Adding New Combining Algorithms</a></li>
<li><a class="reference external" href="#adding-new-finder-modules">Adding New Finder Modules</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="faq.html"
                                  title="previous chapter">Frequently Asked Questions</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="license.html"
                                  title="next chapter">License</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/guide.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="license.html" title="License"
             >next</a> |</li>
        <li class="right" >
          <a href="faq.html" title="Frequently Asked Questions"
             >previous</a> |</li>
<li><a href="index.html">home</a>&nbsp;|&nbsp;</li>
<li><a href="http://sourceforge.net/projects/sunxacml">project page</a>&nbsp;|&nbsp;</li>
<li><a href="http://sourceforge.net/projects/sunxacml/files/">download</a>&nbsp;|&nbsp;</li>
<li><a href="http://sunxacml.hg.sourceforge.net/hgweb/sunxacml/sunxacml/">source code</a></li>
&raquo;
 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Sun.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.4.
    </div>
  </body>
</html>